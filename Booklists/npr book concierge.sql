SELECT *
FROM(
SELECT
--link to Encore, removed in favor of default keyword search on title
--'https://find.minlib.net/iii/encore/record/C__R'||id2reckey(b.bib_record_id)   AS field_booklist_entry_encore_url,
b.best_title as title,
REPLACE(SPLIT_PART(SPLIT_PART(b.best_author,' (',1),', ',2),'.','')||' '||SPLIT_PART(b.best_author,', ',1) as field_booklist_entry_author,
CASE
WHEN b.material_code = 'a'
THEN (SELECT
'https://syndetics.com/index.aspx?isbn='||SUBSTRING(s.content FROM '[0-9]+')||'/SC.gif&client=minuteman'
FROM
sierra_view.subfield s
WHERE
b.bib_record_id = s.record_id AND s.marc_tag = '020' AND s.tag = 'a'
ORDER BY s.occ_num
LIMIT 1)
WHEN b.material_code != 'a'
THEN (SELECT
'https://syndetics.com/index.aspx?upc='||SUBSTRING(s.content FROM '[0-9]+')||'/SC.gif&client=minuteman'
FROM
sierra_view.subfield s
WHERE
b.bib_record_id = s.record_id AND s.marc_tag = '024' AND s.tag = 'a'
ORDER BY s.occ_num
LIMIT 1)
END AS field_booklist_entry_cover

FROM
sierra_view.bib_record_property b
JOIN sierra_view.bib_record_item_record_link bi
ON
b.bib_record_id = bi.bib_record_id
JOIN
sierra_view.bib_view v
ON
b.bib_record_id = v.id AND
v.record_num IN (
'3902284',
'3904964',
'3912113',
'3913276',
'3914429',
'3936761',
'3936848',
'3937624',
'3940889',
'3944310',
'3944994',
'3947309',
'3948641',
'3949293',
'3949819',
'3949820',
'3949827',
'3949918',
'3949933',
'3949939',
'3949959',
'3949961',
'3959930',
'3960840',
'3960868',
'3962109',
'3963275',
'3963362',
'3963371',
'3963524',
'3963534',
'3963748',
'3963758',
'3963830',
'3964171',
'3964176',
'4042651',
'3964656',
'3964700',
'3964717',
'3964954',
'3964961',
'3965355',
'3965811',
'3965955',
'3966394',
'3966529',
'3969224',
'3969252',
'3969253',
'3969606',
'3969608',
'3969680',
'3969779',
'3970326',
'3970405',
'3970572',
'3970852',
'3970946',
'3971094',
'3971317',
'3971323',
'3971774',
'3972385',
'3973179',
'3973269',
'3974360',
'3974397',
'3974592',
'3974803',
'3974831',
'3975189',
'3975214',
'3975698',
'3975846',
'3975923',
'3975936',
'3975981',
'3976087',
'3976715',
'3976854',
'3976918',
'3977011',
'3977066',
'3977079',
'3977293',
'3977299',
'3977359',
'3977703',
'3977704',
'3977708',
'3977710',
'3977727',
'3977743',
'3977803',
'3978016',
'3978046',
'3978066',
'3978243',
'3979051',
'3979447',
'3979505',
'3979990',
'3981412',
'3981829',
'3981830',
'3982297',
'3982304',
'3982315',
'3982317',
'3982399',
'3982444',
'3989289',
'3982508',
'3982509',
'3982648',
'3983118',
'3983149',
'3983325',
'3983331',
'3983342',
'3983375',
'3983609',
'3983921',
'3984012',
'3984013',
'3984096',
'3984268',
'3984293',
'3984573',
'3984604',
'3984665',
'3984677',
'3984788',
'3984934',
'3984995',
'3985279',
'3986845',
'3986964',
'3986969',
'3986995',
'3987012',
'3987015',
'3987024',
'3987054',
'3987083',
'3987110',
'3987209',
'3987373',
'3987487',
'3987492',
'3987610',
'3987625',
'3987746',
'3987766',
'3987767',
'3987792',
'3987798',
'3988025',
'3988324',
'3988325',
'3988462',
'3988469',
'3988862',
'3989111',
'3989223',
'3989604',
'3989622',
'3990186',
'3990263',
'3990288',
'3990360',
'3991782',
'3991839',
'3992358',
'3992426',
'3992487',
'3992515',
'3992805',
'3993302',
'3993664',
'3993870',
'3994436',
'3994544',
'3994703',
'3994983',
'3995031',
'3995265',
'3995730',
'3996160',
'3996167',
'3997053',
'3997147',
'3997556',
'3997621',
'3997624',
'3999527',
'3999614',
'3999646',
'3999647',
'3999701',
'4001055',
'4001553',
'4002047',
'4002065',
'4002070',
'4002161',
'4002192',
'4002254',
'4002414',
'4003369',
'4003440',
'4006811',
'4007088',
'4007141',
'4007364',
'4007627',
'4008178',
'4008957',
'4011807',
'4011936',
'4012638',
'4013304',
'4013729',
'4013846',
'4014126',
'4015792',
'4015900',
'4015904',
'4015908',
'4015912',
'4015913',
'4015918',
'4015968',
'4016007',
'4016023',
'4016027',
'4016179',
'4016180',
'4016187',
'4016220',
'4016561',
'4016592',
'4017914',
'4017958',
'4018242',
'4018252',
'4018297',
'4018308',
'4018327',
'4018376',
'4018377',
'4018381',
'4018481',
'4018518',
'4018541',
'4018578',
'4018582',
'4018658',
'4018667',
'4018955',
'4019038',
'4019045',
'4019110',
'4019112',
'4019213',
'4019234',
'4019693',
'4019703',
'4019740',
'4019770',
'4019771',
'4019772',
'4019781',
'4019783',
'4019845',
'4019999',
'4020027',
'4020028',
'4020049',
'4020056',
'4020059',
'4020150',
'4020160',
'4020203',
'4020211',
'4020228',
'4020229',
'4020339',
'4020342',
'4020344',
'4020348',
'4020388',
'4020608',
'4020734',
'4020970',
'4020986',
'4021106',
'4021116',
'4021212',
'4021219',
'4021432',
'4021465',
'4021496',
'4021497',
'4021565',
'4021674',
'4021680',
'4021844',
'4021940',
'4021959',
'4022210',
'4022260',
'4022337',
'4022747',
'4022823',
'4023573',
'4023788',
'4023863',
'4023926',
'4024174',
'4024258',
'4024547',
'4024602',
'4024768',
'4024858',
'4026011',
'4026087',
'4026142',
'4026530',
'4026884',
'4026916',
'4027132',
'4027198',
'4027229',
'4027456',
'4028145',
'4028177',
'4028199',
'4028210',
'4028266',
'4028512',
'4028776',
'4029656',
'4029915',
'4030680',
'4031023',
'4031238',
'4031361',
'4031506',
'4032314',
'4032385',
'4032618',
'4032692',
'4032745',
'4034782',
'4035324',
'4035926',
'4036478',
'4036899',
'4037899',
'4043255',
'4044875',
'4047948',
'4049211',
'4049765',
'4050193',
'4051507',
'4053318',
'4054007',
'4054620',
'4055126',
'4055200',
'4055489'

)
GROUP BY b.bib_record_id,1,2,b.material_code 
) a
ORDER BY RANDOM()
LIMIT 50;
;